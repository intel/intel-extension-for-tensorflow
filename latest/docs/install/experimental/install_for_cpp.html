<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Intel® Extension for TensorFlow* for C++ &mdash; Intel® Extension for TensorFlow* v1.0.0 documentation</title><link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/custom.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  <script id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="Examples" href="../../../examples/examples.html" />
    <link rel="prev" title="Build from Source Code" href="../how_to_build.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../../index.html" class="icon icon-home"> Intel® Extension for TensorFlow*
          </a>
              <div class="version">
                <a href="../../../../versions.html">latest ▼</a>
                <p>Click link above to switch version</p>              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../get_started.html">Quick Get Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../guide/infrastructure.html">Infrastructure</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../guide/features.html">Features</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../installation_guide.html">Installation Guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../install_for_gpu.html">Intel GPU Software Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="install_for_cpu.html"><em>Experimental:</em> Intel CPU Software Installation</a></li>
<li class="toctree-l2"><a class="reference internal" href="install_for_gpu_conda.html">Conda Environment Installation Instructions</a></li>
<li class="toctree-l2"><a class="reference internal" href="../how_to_build.html">Build from Source Code</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Intel® Extension for TensorFlow* for C++</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#prepare">Prepare</a></li>
<li class="toctree-l3"><a class="reference internal" href="#configure-the-build">Configure the build</a></li>
<li class="toctree-l3"><a class="reference internal" href="#build-the-cc-library">Build the CC library</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#gpu-support">GPU support</a></li>
<li class="toctree-l4"><a class="reference internal" href="#cpu-only-experimental">CPU only (experimental)</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#build-libtensorfow-cc-so">Build libtensorfow_cc.so</a></li>
<li class="toctree-l3"><a class="reference internal" href="#integrate-the-cc-library">Integrate the CC library</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#linker">Linker</a></li>
<li class="toctree-l4"><a class="reference internal" href="#load">Load</a><ul>
<li class="toctree-l5"><a class="reference internal" href="#example">Example</a></li>
</ul>
</li>
<li class="toctree-l4"><a class="reference internal" href="#build-and-run">Build and run</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../examples/examples.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../guide/practice_guide.html">Practice Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../guide/FAQ.html">Frequently Asked Questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../community/releases.html">Releases</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../community/contributing.html">Contributing guidelines</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../SECURITY.html">Security Policy</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/intel/intel-extension-for-tensorflow">GitHub Repository</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">Intel® Extension for TensorFlow*</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../installation_guide.html">Installation Guide</a> &raquo;</li>
      <li>Intel® Extension for TensorFlow* for C++</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../../_sources/docs/install/experimental/install_for_cpp.md.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="section" id="intel-extension-for-tensorflow-for-c">
<h1>Intel® Extension for TensorFlow* for C++<a class="headerlink" href="#intel-extension-for-tensorflow-for-c" title="Permalink to this headline">¶</a></h1>
<p>This guide shows how to build an Intel® Extension for TensorFlow* CC library from source and how to work with tensorflow_cc to build bindings for C/C++ languages on ubuntu 20.04 (64-bit).</p>
<div class="section" id="prepare">
<h2>Prepare<a class="headerlink" href="#prepare" title="Permalink to this headline">¶</a></h2>
<p>Refer to <a class="reference external" href="../how_to_build.html#prepare">Build from Source Code -&gt; Prepare</a></p>
</div>
<div class="section" id="configure-the-build">
<h2>Configure the build<a class="headerlink" href="#configure-the-build" title="Permalink to this headline">¶</a></h2>
<p>Refer to <a class="reference external" href="../how_to_build.html#configure-the-build">Build from Source Code -&gt; Configure the build</a></p>
</div>
<div class="section" id="build-the-cc-library">
<h2>Build the CC library<a class="headerlink" href="#build-the-cc-library" title="Permalink to this headline">¶</a></h2>
<div class="section" id="gpu-support">
<h3>GPU support<a class="headerlink" href="#gpu-support" title="Permalink to this headline">¶</a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ bazel build -c opt --config<span class="o">=</span>gpu //itex:itex_gpu_cc
</pre></div>
</div>
<p>CC library location: <code class="docutils literal notranslate"><span class="pre">&lt;Path</span> <span class="pre">to</span> <span class="pre">intel-extension-for-tensorflow&gt;/bazel-bin/itex/libitex_gpu_cc.so</span></code></p>
</div>
<div class="section" id="cpu-only-experimental">
<h3>CPU only (experimental)<a class="headerlink" href="#cpu-only-experimental" title="Permalink to this headline">¶</a></h3>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ bazel build -c opt --config<span class="o">=</span>cpu //itex:itex_cpu_cc
</pre></div>
</div>
<p>CC library location: <code class="docutils literal notranslate"><span class="pre">&lt;Path</span> <span class="pre">to</span> <span class="pre">intel-extension-for-tensorflow&gt;/bazel-bin/itex/libitex_cpu_cc.so</span></code></p>
</div>
</div>
<div class="section" id="build-libtensorfow-cc-so">
<h2>Build libtensorfow_cc.so<a class="headerlink" href="#build-libtensorfow-cc-so" title="Permalink to this headline">¶</a></h2>
<p>a. Prepare TensorFlow* source code</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ git clone https://github.com/tensorflow/tensorflow.git
$ git checkout origin/r2.12 -b r2.12
$ <span class="nb">cd</span> tensorflow
</pre></div>
</div>
<p>Apply patch as below to support <strong>TF_LoadPluggableDeviceLibrary</strong>, which is defined in “//tensorflow/c:c_api_experimental”
<a class="reference external" href="https://github.com/tensorflow/tensorflow/issues/58533">A feature request</a> has been reported to TensorFlow*. Once it is solved, this patch is no longer needed.</p>
<div class="highlight-diff notranslate"><div class="highlight"><pre><span></span><span class="gh">diff --git a/tensorflow/BUILD b/tensorflow/BUILD</span><span class="w"></span>
<span class="gh">index 19ee8000206..77d8c714729 100644</span><span class="w"></span>
<span class="gd">--- a/tensorflow/BUILD</span><span class="w"></span>
<span class="gi">+++ b/tensorflow/BUILD</span><span class="w"></span>
<span class="gu">@@ -1187,6 +1187,7 @@ tf_cc_shared_library(</span><span class="w"></span>
<span class="w"> </span>    visibility = [&quot;//visibility:public&quot;],<span class="w"></span>
<span class="w"> </span>    win_def_file = &quot;:tensorflow_filtered_def_file&quot;,<span class="w"></span>
<span class="w"> </span>    deps = [<span class="w"></span>
<span class="gi">+        &quot;//tensorflow/c:c_api_experimental&quot;,</span><span class="w"></span>
<span class="w"> </span>        &quot;//tensorflow/c:c_api&quot;,<span class="w"></span>
<span class="w"> </span>        &quot;//tensorflow/c:env&quot;,<span class="w"></span>
<span class="w"> </span>        &quot;//tensorflow/c:kernels&quot;,<span class="w"></span>
</pre></div>
</div>
<p>b. Build libtensorflow_cc.so</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ ./configure
$ bazel build --jobs <span class="m">96</span> --config<span class="o">=</span>opt //tensorflow:libtensorflow_cc.so
$ ls ./bazel-bin/tensorflow/libtensorflow_cc.so
</pre></div>
</div>
<p>libtensorflow_cc.so location: <code class="docutils literal notranslate"><span class="pre">&lt;Path</span> <span class="pre">to</span> <span class="pre">tensorflow&gt;/bazel-bin/tensorflow/libtensorflow_cc.so</span></code></p>
<p>c. Build Tensorflow header files</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ bazel build --config<span class="o">=</span>opt tensorflow:install_headers
$ ls ./bazel-bin/tensorflow/include
</pre></div>
</div>
<p>Tensorflow header file location: <code class="docutils literal notranslate"><span class="pre">&lt;Path</span> <span class="pre">to</span> <span class="pre">tensorflow&gt;/bazel-bin/tensorflow/include</span></code></p>
</div>
<div class="section" id="integrate-the-cc-library">
<h2>Integrate the CC library<a class="headerlink" href="#integrate-the-cc-library" title="Permalink to this headline">¶</a></h2>
<div class="section" id="linker">
<h3>Linker<a class="headerlink" href="#linker" title="Permalink to this headline">¶</a></h3>
<p>If you place the Intel® Extension for TensorFlow* CC library to a non-system directory, such as ~/mydir, then configure the linker environmental variables:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ <span class="nb">export</span> <span class="nv">LIBRARY_PATH</span><span class="o">=</span><span class="nv">$LIBRARY_PATH</span>:~/mydir/
$ <span class="nb">export</span> <span class="nv">LD_LIBRARY_PATH</span><span class="o">=</span><span class="nv">$LD_LIBRARY_PATH</span>:~/mydir/
</pre></div>
</div>
</div>
<div class="section" id="load">
<h3>Load<a class="headerlink" href="#load" title="Permalink to this headline">¶</a></h3>
<p>TensorFlow* has C API: <code class="docutils literal notranslate"><span class="pre">TF_LoadPluggableDeviceLibrary</span></code> to support the pluggable device library.
To support Intel® Extension for TensorFlow* cc library, we need to modify the orginal C++ code:</p>
<p>a. Add the header file: <code class="docutils literal notranslate"><span class="pre">&quot;tensorflow/c/c_api_experimental.h&quot;</span></code>.</p>
<div class="highlight-C++ notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;tensorflow/c/c_api_experimental.h&quot;</span><span class="cp"></span>
</pre></div>
</div>
<p>b. Load libitex_gpu_cc.so or libitex_cpu_cc.so by <code class="docutils literal notranslate"><span class="pre">TF_LoadPluggableDeviceLibrary</span></code>.</p>
<div class="highlight-C++ notranslate"><div class="highlight"><pre><span></span><span class="n">TF_Status</span><span class="o">*</span><span class="w"> </span><span class="n">status</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">TF_NewStatus</span><span class="p">();</span><span class="w"></span>
<span class="n">TF_LoadPluggableDeviceLibrary</span><span class="p">(</span><span class="o">&lt;</span><span class="n">lib_path</span><span class="o">&gt;</span><span class="p">,</span><span class="w"> </span><span class="n">status</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
<div class="section" id="example">
<h4>Example<a class="headerlink" href="#example" title="Permalink to this headline">¶</a></h4>
<p>The original simple example for using <a class="reference external" href="https://www.tensorflow.org/api_docs/cc">TensorFlow* C++ API</a>.</p>
<div class="highlight-c++ notranslate"><div class="highlight"><pre><span></span><span class="c1">// example.cc</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;tensorflow/cc/client/client_session.h&quot;</span><span class="cp"></span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;tensorflow/cc/ops/standard_ops.h&quot;</span><span class="cp"></span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;tensorflow/core/framework/tensor.h&quot;</span><span class="cp"></span>

<span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="k">using</span><span class="w"> </span><span class="k">namespace</span><span class="w"> </span><span class="nn">tensorflow</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="k">using</span><span class="w"> </span><span class="k">namespace</span><span class="w"> </span><span class="nn">tensorflow</span><span class="o">::</span><span class="nn">ops</span><span class="p">;</span><span class="w"></span>

<span class="w">  </span><span class="n">Scope</span><span class="w"> </span><span class="n">root</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Scope</span><span class="o">::</span><span class="n">NewRootScope</span><span class="p">();</span><span class="w"></span>
<span class="w">  </span><span class="k">auto</span><span class="w"> </span><span class="n">X</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Variable</span><span class="p">(</span><span class="n">root</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">},</span><span class="w"> </span><span class="n">DataType</span><span class="o">::</span><span class="n">DT_FLOAT</span><span class="p">);</span><span class="w"></span>
<span class="w">  </span><span class="k">auto</span><span class="w"> </span><span class="n">assign_x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Assign</span><span class="p">(</span><span class="n">root</span><span class="p">,</span><span class="w"> </span><span class="n">X</span><span class="p">,</span><span class="w"> </span><span class="n">RandomNormal</span><span class="p">(</span><span class="n">root</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">},</span><span class="w"> </span><span class="n">DataType</span><span class="o">::</span><span class="n">DT_FLOAT</span><span class="p">));</span><span class="w"></span>
<span class="w">  </span><span class="k">auto</span><span class="w"> </span><span class="n">Y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Variable</span><span class="p">(</span><span class="n">root</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">},</span><span class="w"> </span><span class="n">DataType</span><span class="o">::</span><span class="n">DT_FLOAT</span><span class="p">);</span><span class="w"></span>
<span class="w">  </span><span class="k">auto</span><span class="w"> </span><span class="n">assign_y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Assign</span><span class="p">(</span><span class="n">root</span><span class="p">,</span><span class="w"> </span><span class="n">Y</span><span class="p">,</span><span class="w"> </span><span class="n">RandomNormal</span><span class="p">(</span><span class="n">root</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">},</span><span class="w"> </span><span class="n">DataType</span><span class="o">::</span><span class="n">DT_FLOAT</span><span class="p">));</span><span class="w"></span>
<span class="w">  </span><span class="k">auto</span><span class="w"> </span><span class="n">Z</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Const</span><span class="p">(</span><span class="n">root</span><span class="p">,</span><span class="w"> </span><span class="mf">2.f</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p">});</span><span class="w"></span>
<span class="w">  </span><span class="k">auto</span><span class="w"> </span><span class="n">V</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">MatMul</span><span class="p">(</span><span class="n">root</span><span class="p">,</span><span class="w"> </span><span class="n">assign_x</span><span class="p">,</span><span class="w"> </span><span class="n">assign_y</span><span class="p">);</span><span class="w">  </span>
<span class="w">  </span><span class="k">auto</span><span class="w"> </span><span class="n">VZ</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Add</span><span class="p">(</span><span class="n">root</span><span class="p">,</span><span class="w"> </span><span class="n">V</span><span class="p">,</span><span class="w"> </span><span class="n">Z</span><span class="p">);</span><span class="w"></span>

<span class="w">  </span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">Tensor</span><span class="o">&gt;</span><span class="w"> </span><span class="n">outputs</span><span class="p">;</span><span class="w"></span>
<span class="w">  </span><span class="n">ClientSession</span><span class="w"> </span><span class="nf">session</span><span class="p">(</span><span class="n">root</span><span class="p">);</span><span class="w"></span>
<span class="w">  </span><span class="c1">// Run and fetch VZ</span>
<span class="w">  </span><span class="n">TF_CHECK_OK</span><span class="p">(</span><span class="n">session</span><span class="p">.</span><span class="n">Run</span><span class="p">({</span><span class="n">VZ</span><span class="p">},</span><span class="w"> </span><span class="o">&amp;</span><span class="n">outputs</span><span class="p">));</span><span class="w"></span>
<span class="w">  </span><span class="n">LOG</span><span class="p">(</span><span class="n">INFO</span><span class="p">)</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="s">&quot;Output:</span><span class="se">\n</span><span class="s">&quot;</span><span class="w"> </span><span class="o">&lt;&lt;</span><span class="w"> </span><span class="n">outputs</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">matrix</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="p">();</span><span class="w"></span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>The updated example with Intel® Extension for TensorFlow* enabled</p>
<div class="highlight-diff notranslate"><div class="highlight"><pre><span></span><span class="w">// example.cc</span>
<span class="w">#include &quot;tensorflow/cc/client/client_session.h&quot;</span>
<span class="w">#include &quot;tensorflow/cc/ops/standard_ops.h&quot;</span>
<span class="w">#include &quot;tensorflow/core/framework/tensor.h&quot;</span>
<span class="gi">+ #include &quot;tensorflow/c/c_api_experimental.h&quot;</span><span class="w"></span>

<span class="w">int main() {</span>
<span class="w"> </span> using namespace tensorflow;<span class="w"></span>
<span class="w"> </span> using namespace tensorflow::ops;<span class="w"></span>

<span class="gi">+  TF_Status* status = TF_NewStatus();</span><span class="w"></span>
<span class="gi">+  string xpu_lib_path = &quot;libitex_gpu_cc.so&quot;;</span><span class="w"></span>
<span class="gi">+  TF_LoadPluggableDeviceLibrary(xpu_lib_path.c_str(), status);</span><span class="w"></span>
<span class="gi">+  TF_Code code = TF_GetCode(status);</span><span class="w"></span>
<span class="gi">+  if ( code == TF_OK ) {</span><span class="w"></span>
<span class="gi">+      LOG(INFO) &lt;&lt; &quot;intel-extension-for-tensorflow load successfully!&quot;;</span><span class="w"></span>
<span class="gi">+  } else {</span><span class="w"></span>
<span class="gi">+      string status_msg(TF_Message(status));</span><span class="w"></span>
<span class="gi">+      LOG(WARNING) &lt;&lt; &quot;Could not load intel-extension-for-tensorflow, please check! &quot; &lt;&lt; status_msg;</span><span class="w"></span>
<span class="gi">+  }</span><span class="w"></span>

<span class="w"> </span> Scope root = Scope::NewRootScope();<span class="w"></span>
<span class="w"> </span> auto X = Variable(root, {5, 2}, DataType::DT_FLOAT);<span class="w"></span>
<span class="w"> </span> auto assign_x = Assign(root, X, RandomNormal(root, {5, 2}, DataType::DT_FLOAT));<span class="w"></span>
<span class="w"> </span> auto Y = Variable(root, {2, 3}, DataType::DT_FLOAT);<span class="w"></span>
<span class="w"> </span> auto assign_y = Assign(root, Y, RandomNormal(root, {2, 3}, DataType::DT_FLOAT));<span class="w"></span>
<span class="w"> </span> auto Z = Const(root, 2.f, {5, 3});<span class="w"></span>
<span class="w"> </span> auto V = MatMul(root, assign_x, assign_y);  <span class="w"></span>
<span class="w"> </span> auto VZ = Add(root, V, Z);<span class="w"></span>

<span class="w"> </span> std::vector&lt;Tensor&gt; outputs;<span class="w"></span>
<span class="w"> </span> ClientSession session(root);<span class="w"></span>
<span class="w"> </span> // Run and fetch VZ<span class="w"></span>
<span class="w"> </span> TF_CHECK_OK(session.Run({VZ}, &amp;outputs));<span class="w"></span>
<span class="w"> </span> LOG(INFO) &lt;&lt; &quot;Output:\n&quot; &lt;&lt; outputs[0].matrix&lt;float&gt;();<span class="w"></span>
<span class="w"> </span> return 0;<span class="w"></span>
<span class="w">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="build-and-run">
<h3>Build and run<a class="headerlink" href="#build-and-run" title="Permalink to this headline">¶</a></h3>
<p>Place a <code class="docutils literal notranslate"><span class="pre">Makefile</span></code> file in the same directory of <code class="docutils literal notranslate"><span class="pre">example.cc</span></code> with the following contents:</p>
<ul class="simple">
<li><p>Replace <code class="docutils literal notranslate"><span class="pre">&lt;TF_INCLUDE_PATH&gt;</span></code> with local tensorflow include path: <code class="docutils literal notranslate"><span class="pre">&lt;Path</span> <span class="pre">to</span> <span class="pre">tensorflow&gt;/bazel-bin/tensorflow/include/</span></code></p></li>
<li><p>Replace <code class="docutils literal notranslate"><span class="pre">&lt;TFCC_PATH&gt;</span></code> with local tensorflow_cc path: <code class="docutils literal notranslate"><span class="pre">&lt;Path</span> <span class="pre">to</span> <span class="pre">tensorflow&gt;/bazel-bin/tensorflow/</span></code></p></li>
</ul>
<div class="highlight-Makefile notranslate"><div class="highlight"><pre><span></span>// Makefile
target = example_test
cc = g++
TF_INCLUDE_PATH = &lt;TF_INCLUDE_PATH&gt;
TFCC_PATH = &lt;TFCC_PATH&gt;
include = -I $(TF_INCLUDE_PATH)
lib = -L $(TFCC_PATH) -ltensorflow_framework -ltensorflow_cc
flag = -Wl,-rpath=$(TFCC_PATH)
source = ./example.cc
$(target): $(source)
	$(cc) $(source) -o $(target) $(include) $(lib) $(flag)
clean:
	rm $(target)
run:
	./$(target)
</pre></div>
</div>
<p>Go to the directory of example.cc and Makefile, then build and run example.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ make
$ ./example_test
</pre></div>
</div>
<p><strong>NOTE:</strong> For GPU support, please setup oneapi environment variables before run.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$ <span class="nb">source</span> /opt/intel/oneapi/setvars.sh
</pre></div>
</div>
</div>
</div>
</div>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../how_to_build.html" class="btn btn-neutral float-left" title="Build from Source Code" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../../../examples/examples.html" class="btn btn-neutral float-right" title="Examples" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright Copyright (c) 2022 Intel Corporation.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>